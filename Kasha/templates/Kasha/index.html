{% extends 'Kasha/base.html' %}
{% load staticfiles %}
{% load bootstrap3 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
{% block content %}
{% load kasha_extras %}

{% load crispy_forms_tags %}


{% block header %}
<link href="{% static 'index.css' %}" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    {% endblock header %}
<div class="container-fluid">

      <div class="starter-template">
        <h1>Gotta Kashe?</h1>
      </br>
<form class="guess-form" action="#" method="post">
                                    {% csrf_token %}
                                    <div class="row center-block">
                                      <div class="col-6 col-md-4">
                                    {{ sefariaAPIForm.torahType }}
                                  </div>
                                  <div class="col-6 col-md-4">
                                    {{ sefariaAPIForm.sefer }}
                                  </div>
                                  <div class="col-6 col-md-4">
                                    {{ sefariaAPIForm.perek }}
                                  </div>
                                  </div>

                                    {% if sefariaAPIForm.errors %}
                                        {% for field in sefariaAPIForm %}
                                            {% for error in field.errors %}
                                                <div class="alert alert-error">
                                                    <strong>{{ error|escape }}</strong>
                                                </div>
                                            {% endfor %}
                                        {% endfor %}
                                        {% for error in sefariaAPIForm.non_field_errors %}
                                            <div class="alert alert-error">
                                                <strong>{{ error|escape }}</strong>
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                  </br>
                                    {% bootstrap_button "Search" button_type="submit" button_class="btn-primary" %}
                                </form>
                                <!-- start search results -->

                                    <input type="button" value="English" class="btnLanguage" data-language="eng" />
                                    <input type="button" value="Both" class="btnLanguage" data-language="both" />
                                   <input type="button" value="Hebrew" class="btnLanguage" data-language="heb" />
                                   <input type="button" value="Question Builder" class="btnBuilder"/>

                                  <h2>{{sefer|title}} {{perek}}</h2>




                                  <table class="outer-table table-bordered">
                                    <tbody>
                                      <tr>
                                        <td>
                                          <table id="table" class="table table-striped">
                                            <tbody>
                                                {% for pasuk, verse in chumash_rashi.items %}
                                                <tr class="has-link clickable-row pasuk-item" data-href='{% url 'kasha:index' %}{{ sefer }}/{{perek}}/{{pasuk}}'>
                                                <td class="eng-text"><span class="pasuk-num">{{ pasuk }}.</span>{{ verse.en | safe }} </td>

                                                <td dir="rtl" class="heb-text">{{ verse.he }} </td>

                                                <td>{{ verses|keyvalue:pasuk|keyvalue:'num_questions' }}</td>
                                                
                                              </tr>
                                          {% if verse.rashi.items %}
                                            {% for rashi, r in verse.rashi.items %}
                                            <tr class="rashi-item">
                                              <td class="eng-text eng-rashi ">{{ r.en | safe  }}</td>
                                              <td dir="rtl" class="heb-text heb-rashi">{{ r.he | safe  }}</td>
                                             </tr>
                                            {% endfor %} 
                                            {% endif %}
                                  {% empty %}
                                  <p>Shteig</p>
                                  {% endfor %}
                                   </tbody>
                                </table>
                            </td>
                              <!-- end search results row -->
                              <!-- start question builder row -->
                              <td class="question-builder">
                                <h3>Question</h3>
                                {% crispy question_builder_form question_builder_form.helper %}
                                <!--
                                <form action="#" method="POST">
                                  {% csrf_token %}
                                          {{ questionForm.question_text }}
                                          <input type="hidden" name="form-type" value="question-form" /> <!-- set type 
                                          <input type="submit" value="Submit" />
                                      </form> -->
                              </td>
                              </tr>
                                </tbody>
                                </table>
          </div>
    </div> <!-- /.container -->
{% endblock content %}


{% block script %}
<script type="text/javascript">
var torahCategory = {
    Chumash: ["Genesis", "Exodus", "Leviticus", "Numbers", "Deuteronomy"],
    Gemara: ["Juice", "Water", "Others"]
}

var chumashPerakim = {
  Genesis: [51],
  Exodus: [41],
  Leviticus: [28],
  Numbers: [37],
  Deuteronomy: [35]
}

    function changecat(value) {
        if (value.length == 0) document.getElementById("category").innerHTML = "<option></option>";
        else {
            var catOptions = "";
            for (categoryId in torahCategory[value]) {
                catOptions += "<option>" + torahCategory[value][categoryId] + "</option>";
            }
            document.getElementById("category").innerHTML = catOptions;
            changeper('Genesis');
        }
    }

        function changeper(value) {
        if (value.length == 0) document.getElementById("perek").innerHTML = "<option></option>";
        else {
            var perOptions = "";
            for (i = 1; i < chumashPerakim[value]; i++) {
                perOptions += "<option>" + i + "</option>";
            }
            document.getElementById("perek").innerHTML = perOptions;
        }
    }

$(document).ready(function(){
    $('.btnLanguage').click(function() {

       language = $(this).data("language");

       languages = ['eng', 'heb']

       var diff = $(languages).not([language]).get()

       console.log(diff);

       if (diff.length == 2){
        $('#table').find('.heb-text, .eng-text').removeClass('hidden');
       } else {

       $('#table').find('.' + diff + '-text').addClass('hidden');

       $('#table').find('.' + language + '-text').removeClass('hidden');
       }
    });
});
 
$(document).ready(function(){
  /*
  toggles question builder col visible or not via button
  */
    $('.btnBuilder').click(function() {
      console.log("question builder");
      idName = 'question-builder'; 
      $('.question-builder').toggle();
      });
    });


jQuery(document).ready(function($) {
    $(".clickable-row").click(function() {
      console.log("hello world");
      console.log($(this).data("href"));
        window.location = $(this).data("href");
        console.log(window.location);
    });
  });
</script>
{% endblock %}